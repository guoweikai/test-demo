<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    #pullstream{
        width:500px;
        height: 500px;
    }
</style>
<script src="https://rtc-web.linkv.fun/Web_SDK/dist/liveme/OctopusRTC-2.0.2-alpha.js"></script>

<body>
    <div>
        <video id="pullstream" controls autoplay></video>
    </div>
    <script>

        const handleCallbackFun = () => {
            octopusRTC.on('disconnect', async (err) => {
                console.log('handleDisconnect:::', err);
            })
            // add by version 2.0.0
            const playCallback = ({ code, streamId, state }) => {
                console.log('event emit play-state-update:::', code, streamId, state, this.streamList);
                const type = code;
                document.getElementById("pullstream").srcObject =stream;
                document.getElementById("pullstream").play();

            };
            octopusRTC.on('play-state-update', playCallback);

            // add by version2.0.0
            octopusRTC.on('publish-state-update', ({ code, streamId, state }) => {
                console.log('event emit publisherStateUpdate1212', code, state);
                const type = code;
                // if (type == 1) {
                //     if (this.source == 1) {
                //         this.updateRoom('1');
                //         setTimeout(() => {
                //             this.intervalUpdateRoom();
                //         }, 500);
                //     }
                // } else if (type == 2) {
                //     // this.publishStream();
                // } else if (type == 0) {
                //     this.$toast({ content: `${streamId}推流失败。` })
                // }
            });
            octopusRTC.on('stream-update', ({ code, streamList }) => {
                console.log('onStreamUpdated:::', code, streamList);
                const type = code;

                if (type == 1) {
                    // streamList.forEach(async (stream, index, arr) => {
                    //     if (stream.userId == this.userId) {
                    //         streamList.splice(index, 1);
                    //     }
                    //     this.$toast({ content: `${stream.userId}${this.$t('m.joinRoom')}` });
                    //     this.streamList.push({
                    //         userId: stream.userId,
                    //         streamId: stream.streamId,
                    //         roomId: stream.roomId,
                    //         stream: await this.palyStream(stream.userId)
                    //     });
                    // });
                    // if (!this.isShowRightList) { this.isShowRightList = true; }
                }
                // if (type == 1) {
                //     streamList.forEach(async (stream, index, arr) => {
                //         if (stream.userId == this.userId) {
                //             streamList.splice(index, 1);
                //         }
                //         this.$toast({ content: `${stream.userId}${this.$t('m.joinRoom')}` });
                //         this.streamList.push({
                //             userId: stream.userId,
                //             streamId: stream.streamId,
                //             roomId: stream.roomId,
                //             stream: await this.palyStream(stream.userId)
                //         });
                //     });
                //     if (!this.isShowRightList) { this.isShowRightList = true; }
                // } else if (type == 0) {
                //     this.streamList.forEach((value, key) => {
                //         if (value.userId == streamList[0].userId) {
                //             if (value.userId.indexOf('H') != -1) {
                //                 this.$toast({ content: this.$t('m.anchorleave') });
                //                 setTimeout(() => {
                //                     this.close();
                //                 }, 2000);
                //             } else {
                //                 this.streamList.splice(key, 1);
                //                 octopusRTC.stopPlayingStream(value.userId);
                //                 this.$toast({ content: `${streamList[0].userId}${this.$t('m.leaveRoom')}` });
                //             }
                //         }
                //     });
                //     if (this.streamList.length == 0) {
                //         this.$toast({ content: this.$t('m.nobody') });
                //         setTimeout(() => {
                //             this.close();
                //         }, 2000);
                //     }
                // }
            })
            // octopusRTC.onStreamUpdated = (type, streamList) => {

            // };
        }
        let stream = "";
        const roomId = "M123"
        const _config = {
            appId: "5291372290",
            logLevel: 1,
            remoteLogLevel: 1,
            userId: "guoweikai",
            userName: 'u' + new Date().getTime(),
            roomId,
            // env: this.currentConfig.env,
            // edgeUrl: this.currentConfig.edgeUrl
        }
        const octopusRTC = new OctopusRTC(_config)
        octopusRTC.init()
        handleCallbackFun();
        octopusRTC.login(roomId, 2).then((res) => {
            // 去拉流
            console.log(res)
            const [{ userId }] = res
            console.log(userId)
            octopusRTC.startPlayingStream(userId).then((res) => {
                console.log(res)
                stream = res;
            });
        })
    </script>
</body>

</html>